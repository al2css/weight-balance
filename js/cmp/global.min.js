$(document).ready(function(){WeightAndBalance.init()});var WeightAndBalance={init:function(){}},WeightBalanceApp=angular.module("WeightBalanceApp",["ngRoute","ngTouch","ngSanitize","ui.bootstrap"]);WeightBalanceApp.config(["$routeProvider",function(a){a.when("/login",{controller:"LoginCtrl",templateUrl:"app/partials/_login.html",controllerAs:"login"}).when("/my-flights",{controller:"FlightsCtrl",templateUrl:"app/partials/_my-flights.html",controllerAs:"myFlights"}).when("/available-flights",{controller:"FlightsCtrl",templateUrl:"app/partials/_available-flights.html",controllerAs:"myFlights"}).when("/flights/:id",{controller:"FlightCtrl",templateUrl:"app/partials/_flight.html",controllerAs:"flight"}).when("/home",{controller:"HomeCtrl",templateUrl:"app/partials/_home.html",controllerAs:"home"}).when("/inbox",{controller:"InboxCtrl",templateUrl:"app/partials/_inbox.html",controllerAs:"inbox"}).when("/inbox/email/:id",{controller:"EmailCtrl",templateUrl:"app/partials/_email.html",controllerAs:"email"}).when("/notifications",{controller:"NotificationsCtrl",templateUrl:"app/partials/_notifications.html",controllerAs:"notifications"}).otherwise({redirectTo:"/login"})}]),WeightBalanceApp.controller("HomeCtrl",["$scope","$location",function(a,b){function c(){}this.title="Home",c(),a.getClass=function(a){return b.path().substr(0,a.length)==a?"current":""}}]),WeightBalanceApp.controller("LoginCtrl",["$scope","$location",function(a,b){this.title="Login",this.user="",a.changeView=function(a){b.path(a)},a.logIn=function(){a.changeView("my-flights")}}]),WeightBalanceApp.controller("FlightCtrl",["$scope","$location","$routeParams","FlightFactory",function(a,b,c,d){this.title="This flight page",this.reqFlight={};var e=d.getFlight(c);e&&e.then(angular.bind(this,function(a){d.reqFlight=a,this.reqFlight=d.reqFlight}))}]),WeightBalanceApp.controller("FlightsCtrl",["$scope","$location","FlightsFactory",function(a,b,c){this.title="Flights page!",this.flights={},this.hours=24,this.date=new Date,this.myWorkingHours=[],this.dayOfWeek=this.date.getDay(),this.currentHour=this.date.getHours(),this.timespanWidth=parseFloat(100/this.hours).toFixed(3);var d=[],e=[],f=[];c.getFlights().then(angular.bind(this,function(){this.flights=c.flights})),a.setFlightToMinutes=function(a){var b=new Date(1e3*a),c=(b.getHours(),b.getMinutes()),d=parseFloat(100*c/60).toFixed(3);return{left:d+"%"}},a.goToFlight=function(a,b){c.goToFlight(a,b)},a.addToMyFlights=function(a,b){c.addToMyFlights(a,b)},a.removeFlight=function(a,b){c.removeFlight(a,b)},a.getClass=function(a){return b.path().substr(0,a.length)==a?"current":""};for(var g=0;g<this.hours;g++)d.push(g);for(var g=this.currentHour;g<this.hours;g++)e.push(g);$.each(d,function(a){-1===e.indexOf(a)&&f.push(a)}),this.myWorkingHours=e.concat(f)}]),WeightBalanceApp.controller("InboxCtrl",["$scope","$location","InboxFactory",function(a,b){this.title="Inbox",this.messages={},a.getClass=function(a){return b.path().substr(0,a.length)==a?"current":""}}]),WeightBalanceApp.controller("EmailCtrl",["$scope","$location","InboxFactory",function(a,b){this.title="Email read",this.email={},a.getClass=function(a){return b.path().substr(0,a.length)==a?"current":""}}]),WeightBalanceApp.controller("NotificationsCtrl",["$scope","$location",function(a,b){this.title="Notifications",this.notifications={},a.getClass=function(a){return b.path().substr(0,a.length)==a?"current":""}}]),angular.module("WeightBalanceApp").directive("inbox",["InboxFactory",function(a){"use strict";return{restrict:"EA",replace:!0,scope:!0,templateUrl:"app/directives/inbox.tmpl.html",controllerAs:"viewInbox",controller:function(){this.inboxMessages={},a.getMessages().then(angular.bind(this,function(){this.inboxMessages=a.messages})),this.goToMessage=function(b){a.goToMessage(b)},this.deleteMessage=function(b,c){a.deleteMessage(b,c)}},link:function(){}}}]),angular.module("WeightBalanceApp").directive("email",["$timeout","EmailFactory","$routeParams",function(a,b,c){"use strict";return{restrict:"E",replace:!0,scope:!0,templateUrl:"app/directives/email.tmpl.html",controllerAs:"email",controller:function(){this.message={},this.reply=function(a){b.reply(a)};var a=b.getMessage(c);a&&a.then(angular.bind(this,function(a){b.message=a,this.message=b.message}))},link:function(b,c){var d=c.find(".email__response-text")[0];b.$watch("reply",function(b,c){b!==c&&b&&a(function(){d.focus()},0)})}}}]),angular.module("WeightBalanceApp").directive("nrmess",["InboxFactory",function(a){"use strict";return{restrict:"EA",replace:!0,scope:!0,templateUrl:"app/directives/nrmessages.tmpl.html",controllerAs:"nrmessages",controller:function(){this.unreadMessages={},a.getUnreadMessages().then(angular.bind(this,function(){angular.forEach(a.unreadMessages,function(b,c){angular.isUndefined(a.unreadMessages[c].unread)||a.unreadMessages[c].unread||a.unreadMessages.splice(c,1)}),this.unreadMessages=a.unreadMessages}))},link:function(){}}}]),angular.module("WeightBalanceApp").directive("nrnotif",["InboxFactory",function(a){"use strict";return{restrict:"EA",replace:!0,scope:!0,templateUrl:"app/directives/nrnotif.tmpl.html",controllerAs:"nrnotif",controller:function(){this.notifications={},a.getNotifications().then(angular.bind(this,function(){this.notifications=a.notifications}))},link:function(){}}}]),angular.module("WeightBalanceApp").directive("notification",["InboxFactory",function(a){"use strict";return{restrict:"EA",replace:!0,scope:!0,templateUrl:"app/directives/notification.tpl.html",controllerAs:"notificationPage",controller:function(){this.notification={},a.getNotifications().then(angular.bind(this,function(){this.notification=a.notifications}))},link:function(){}}}]),angular.module("WeightBalanceApp").directive("lowerDeck",["FlightFactory","$routeParams",function(a,b){"use strict";return{restrict:"EA",replace:!0,scope:!0,templateUrl:"app/directives/lowerDeck.tmpl.html",controllerAs:"lowerDeck",controller:function(){this.lowerdeck={},this.fixedWidth=1200;var c=a.getFlight(b);c&&c.then(angular.bind(this,function(b){this.lowerdeck=b.lower_deck_layout,this.scaledWidth=a.px2InchRatio(this.fixedWidth,this.lowerdeck.deckLength)})),this.setStyle=function(a,b,c,d,e){var f=parseFloat(a*this.scaledWidth).toFixed(3),b=parseFloat(b*this.scaledWidth).toFixed(3),c=parseFloat(c*this.scaledWidth).toFixed(3),g=parseFloat(d).toFixed(2),h=e;switch(h){case"A":return{width:b+"px",height:c+"px",right:parseFloat(f-b/2).toFixed(2)+"px",marginTop:-1*parseInt(c/2,10)+"px"};case"B":return{width:b+"px",height:c+"px",right:parseFloat(f-b/2).toFixed(2)+"px",marginTop:-1*parseInt(c/2,10)+"px"};case"C":if(g>0)return{width:b+"px",height:c+"px",right:parseFloat(f-b/2).toFixed(2)+"px",top:"50%",marginTop:-1*parseInt(c,10)+"px"};if(0>g)return{width:b+"px",height:c+"px",right:parseFloat(f-b/2).toFixed(2)+"px",bottom:"50%",marginBottom:-1*parseInt(c,10)+"px"};break;case"X":return{width:b+"px",height:c+"px",right:parseFloat(f-b/2).toFixed(2)+"px",top:"50%",marginTop:-1*parseInt(c/2,10)+"px"};case"E":return{width:b+"px",height:c+"px",right:parseFloat(f-b/2).toFixed(2)+"px",marginTop:-1*parseInt(c/2,10)+"px"};case"F":return{width:b+"px",height:c+"px",right:parseFloat(f-b/2).toFixed(2)+"px",marginTop:-1*parseInt(c/2,10)+"px"};case"NA":return{width:b+"px",height:c+"px",right:parseFloat(f-b/2).toFixed(2)+"px",marginTop:-1*parseInt(c/2,10)+"px"};case"Y":if(g>0)return{width:b+"px",right:parseFloat(f-b/2).toFixed(2)+"px",top:"0px"};if(0>g)return{width:b+"px",right:parseFloat(f-b/2).toFixed(2)+"px",bottom:"0px"};break;default:return!1}}},link:function(){}}}]),angular.module("WeightBalanceApp").directive("uld",["FlightFactory","$routeParams",function(a,b){"use strict";return{restrict:"EA",replace:!0,scope:!0,templateUrl:"app/directives/uldItems.tmpl.html",controllerAs:"uldItems",controller:function(){this.layout={},this.fixedWidth=1200;var c=a.getFlight(b);c&&c.then(angular.bind(this,function(b){this.layout=b.lower_deck_layout,this.scaledWidth=a.px2InchRatio(this.fixedWidth,this.layout.deckLength)})),this.setStyle=function(a,b,c){var a=parseFloat(a*this.scaledWidth).toFixed(3),b=parseFloat(b*this.scaledWidth).toFixed(3);return{width:a+"px",height:b+"px",marginTop:-1*parseInt(b/2,10)+"px"}}},link:function(){}}}]),angular.module("WeightBalanceApp").directive("draggable",function(){"use strict";return{restrict:"A",scope:!1,link:function(a,b,c){var d=$(".compatibilityClass"+c.draggable).not(".uld_assigned");b.draggable({start:function(){$(".lowerDeck").addClass("workingWith"+c.draggable)},drag:function(){},stop:function(){$(".lowerDeck").removeClass("workingWith"+c.draggable)},revert:function(a){return!a},revertDuration:100,addClasses:!1,opacity:.5,scope:"compatible"+c.draggable,zIndex:200,cursor:"move",containment:".inside_page",snap:".centroids.compatibilityClass"+c.draggable,snapMode:"	inner",snapTolerance:20,refreshPositions:!0}),d.droppable({scope:"compatible"+c.draggable,activeClass:"toDropHere",drop:function(a,b){$(this).addClass("uld_assigned"),$(this).droppable("disable"),b.draggable.draggable("disable",1)}})}}}),angular.module("WeightBalanceApp").filter("getArrayFilter",function(){"use strict";return function(a,b,c){b=parseInt("number"==typeof c?c:b);for(var d=0;b>d;d++)a.push(d);return a}}),angular.module("WeightBalanceApp").filter("numberFixedLen",function(){return function(a,b){var c=parseInt(a,10);if(b=parseInt(b,10),isNaN(c)||isNaN(b))return a;for(c=""+c;c.length<b;)c="0"+c;return c}}),angular.module("WeightBalanceApp").factory("InboxFactory",["$q","$http","$location",function(a,b,c){"use strict";var d={};return d.messages={},d.unreadMessages={},d.notifications={},d.goToMessage=function(a){angular.isNumber(a)&&c.path("inbox/email/"+a)},d.deleteMessage=function(a,b){this.messages.splice(b,1)},d.getMessages=function(){var c=a.defer();return b.get("app/json/emails.json").success(function(a){d.messages=a,c.resolve(a)}).error(function(a){c.reject(a)})},d.getUnreadMessages=function(){var c=a.defer();return b.get("app/json/emails.json").success(function(a){d.unreadMessages=a,c.resolve(a)}).error(function(a){c.reject(a)})},d.getNotifications=function(){var c=a.defer();return b.get("app/json/notifications.json").success(function(a){d.notifications=a,c.resolve(a)}).error(function(a){c.reject(a)})},d.getNrMessages=function(){return d.messages.length},d}]),angular.module("WeightBalanceApp").factory("EmailFactory",["$q","$http","$routeParams",function(a,b){"use strict";var c={};return c.messages={},c.reply=function(a){a&&alert("Reply content: "+a)},c.getMessage=function(c){if(c.id){var d=a.defer();return b.get("app/json/message/"+c.id+".json").success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise}},c}]),angular.module("WeightBalanceApp").factory("FlightsFactory",["$q","$http","$routeParams","$location",function(a,b,c,d){"use strict";var e={};return e.flights={},e.changeView=function(a){d.path(a)},e.goToFlight=function(a,b){angular.isNumber(a)&&b&&e.changeView("flights/"+a)},e.addToMyFlights=function(a,b){if(!angular.isUndefined(a.id)&&angular.isNumber(a.id)){var c=1e3*a.departing_time,d=1e3*e.flights.login_date,f=angular.isNumber(c)&&angular.isNumber(d);if(!(f&&c>=d))return alert("This flight was at "+new Date(c)+", and now is "+new Date(d)+"!"),!1;e.flights.assigned_flights.push(a),e.removeFlight(a,b)}},e.removeFlight=function(a,b){angular.isUndefined(a)||b.splice(b.indexOf(a),1)},e.getFlights=function(){var c=a.defer();return b.get("app/json/flights.json").success(function(a){e.flights=a,c.resolve(a)}).error(function(a){c.reject(a)})},e}]),angular.module("WeightBalanceApp").factory("FlightFactory",["$q","$http","$routeParams","$location",function(a,b,c,d){"use strict";var e={};return e.flight={},e.changeView=function(a){d.path(a)},e.px2InchRatio=function(a,b){return!angular.isUndefined(b)&&angular.isNumber(b)?parseFloat(a/b).toFixed(3):void 0},e.getFlight=function(c){if(c.id){var d=a.defer();return b.get("app/json/flight/flightID"+c.id+".json").success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise}},e}]);